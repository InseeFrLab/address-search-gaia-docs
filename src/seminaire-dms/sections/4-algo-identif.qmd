## Algorithme d'identification d'adresses

![](img/schema_moteur_fr.png){width=75% fig-align="center"}

::: {.notes}
- Succession de requêtes ElasticSearch.
- Étapes de validation des résultats après chaque requête.
- Retourne :
    - le(s) identifiant(s) Gaïa retrouvés.  
    - une indicatrice sur qualité de l'identification.  
    - un ratio qui mesure l'écart entre la 1ère et la 2ème possibilité retournées par Elastic.  
::: 

## Indicatrice qualité

- Dépend du pourcentage de 3-grams de la [**voie du référentiel**].{.blue2} ⊂ [**l'adresse recherchée**]{.green2}.
- Calcul non réalisable avec Elastic, donc effectué post requête.

| Voie qualifiée de | Pourcentage de 3-grams |
|-------------------|------------------------|
| sûre              | ≥ 65%         |
| peu douteuse      | 35% ≤ x < 65% |
| douteuse          | 10% ≤ x < 35% |
| non retrouvée     | < 10%         |

*Exemple : 80% des 3-grams de "verdier" dans "88 avenue verdie".*

::: {.notes}
- Le trigram "ier" n'est jamais matché  
- verdier : 5 trigrams  
- 4 trigrams retrouvés dans 88 avenue verdier  
- 4*100/5 = 80  
::: 

## Valeurs de l'indicatrice qualité

| Valeur | idGaïa maximum retrouvé |
|--------|-------------------------|
| 6 à 10 | idAdresse |
| 3 à 5  | idVoie |
| 2      | idCommune |
| 0 à 1  | Aucun |

## Distance entre la 1ère et la 2ème voie la plus pertinente

$$
\text{ratio} = 1 - \frac{R_2}{R_1}
$$

R1 = score Elastic de la 1ère voie la plus pertinente  
R2 = score Elastic de la 2ème voie la plus pertinente

Plus le ratio est proche de 1, plus le résultat retourné est loin de la 2ème proposition.
