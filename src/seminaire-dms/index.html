<!DOCTYPE html>
<html lang="fr-FR"><head>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-29e2c20b02301cfff04dc8050bf30c7e.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.37">

  <title>Moteur de recherche d'adresse Gaïa – Identification d’adresses avec ElasticSearch</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-27ed07df87b78d55b4ad4c3bb7b1d3ac.css">
  <link rel="stylesheet" href="../_extensions/InseeFrLab/onyxia/logo.css">
  <link rel="stylesheet" href="../custom.css">
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<meta property="og:title" content="Identification d’adresses avec ElasticSearch – Moteur de recherche d’adresse Gaïa">
<meta property="og:description" content="Raya Berova &amp; Benoît Hurpeau (DMRG)">
<meta property="og:site_name" content="Moteur de recherche d'adresse Gaïa">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="../_extensions/InseeFrLab/onyxia/background.svg" data-background-size="contain" class="quarto-title-block center">
  <h1 class="title">Identification d’adresses avec ElasticSearch</h1>
  <p class="subtitle"></p><p><strong><span class="blue2">Raya Berova &amp; Benoît Hurpeau (DMRG)</span></strong></p><p></p>

<div class="quarto-title-authors">
</div>

  <p class="date">28 novembre 2024</p>
</section>
<section id="plan-de-la-présentation" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>Plan de la présentation</h1>
<p>1️⃣ Contexte</p>
<p>2️⃣ Utilisation du référentiel Gaïa</p>
<p>3️⃣ Moteur de recherche ElasticSearch</p>
<p>4️⃣ Algorithme d’identification d’adresses</p>
<p>5️⃣ Performances de l’algorithme d’identification</p>
<p>6️⃣ Discussion</p>
</section>

<section>
<section id="introduction" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>1️⃣ Introduction</h1>

</section>
<section id="origine-du-projet" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Origine du projet</h2>
<ul>
<li>Besoin d’un référentiel complet, stable, fiable, mis à jour.</li>
<li>Faciliter la <span class="blue2"><strong>gestion des adresses</strong></span> au sein du SSP.</li>
<li>Clients : Résil, Géoloc, DMTR…</li>
</ul>
<p><span class="green2"><strong>Gaïa</strong></span> : Référentiel Géographique d’Adresses avec Informations Géolocalisantes.</p>
<aside class="notes">
<p>Parler de l’origine du projet, quand ca a été mis en place, comment, pq…</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<!-- Est ce que la d&#xE9;finition est bonne ? -->
<!-- Est ce que la liste des clients est ok ? -->
<!-- Preciser que ce ne sont pas que des adresses -->
</section>
<section id="une-adresse" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Une adresse</h2>
<!-- 
<center><p>[**num&#xE9;ro**]{.green2} <span style="margin-left: 150px;">[**type de voie**]{.blue2}</span> <span style="margin-left: 150px;">**COG**</span></p></center> -->
<p><br></p>
<p><br></p>
<center>
<p>
<span class="green2"><strong>20</strong></span> <span class="blue2"><strong>bis</strong></span> <span class="purple2"><strong>avenue</strong></span> <span class="red2"><strong>de la marne</strong></span> <span style="margin-left: 130px;"><strong>92049</strong></span>
</p>
</center>
<p><br></p>
<p><br></p>
<!-- <center><p>[**indice de r&#xE9;p&#xE9;tition**]{.green2} <span style="margin-left: 190px;">[**nom de voie**]{.blue2}</span></p></center> -->
</section>
<section id="géométrie-de-ladresse" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Géométrie de l’adresse</h2>
<p><em>Exemple: “88 avenue verdier | 92049” reliée à sa parcelle</em></p>

<img data-src="img/adresse_parcelle.png" class="quarto-figure quarto-figure-center r-stretch" style="width:75.0%"></section>
<section id="le-référentiel-gaïa" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Le référentiel Gaïa</h2>

<img data-src="img/communes_voies_adresses.png" class="quarto-figure quarto-figure-center r-stretch" style="width:75.0%"><aside class="notes">
<p>Autres données disponibles (aspect géométrique des objets) :</p>
<ul>
<li>Pour chaque adresse Gaïa : point gps, lien parcelle.<br>
</li>
<li>Pour chaque commune Gaïa : polygone.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<!-- A verifier -->
</section>
<section id="identifiants-gaïa" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Identifiants Gaïa</h2>
<p><span class="green2"><strong>Identifiant unique et stable</strong></span> pour assurer le suivi des objets dans le temps.</p>
<p><br></p>
<p>Trois niveaux :</p>
<ul>
<li>Identifiant adresse</li>
<li>Identifiant voie</li>
<li>Identifiant commune</li>
</ul>
<p><br></p>
<p>Gestion des <span class="blue2"><strong>scissions et fusions de communes</strong></span>.</p>
</section>
<section id="construction-du-référentiel" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Construction du référentiel</h2>
<p>Sources fiables :</p>
<ul>
<li><span class="green2"><strong>Majic</strong></span> : Mise à jour des informations cadastrales.<br>
</li>
<li><span class="green2"><strong>BAN</strong></span> : Base Adresse Nationale.<br>
</li>
<li><span class="green2"><strong>RCA</strong></span> : Référentiel Commun d’Adresses.</li>
</ul>
<!-- Est ce que c'est assez d&#xE9;taill&#xE9; ? Peut etre mettre la source ? -->
<p>Au moins une mise à jour par trimestre (avec conservation des identifiants Gaïa).</p>
<aside class="notes">
<p>Une mise à jour :</p>
<ol type="1">
<li>Récupérer la nouvelle base d’une source données.<br>
</li>
<li>Identifier les adresses textuellement :<br>
</li>
</ol>
<ul>
<li>Les adresses qui sont retrouvées sont alors modifiées si des nouveautés apparaissent.<br>
</li>
<li>Les adresses non retrouvées entraînent la création de nouveaux objets Gaïa.<br>
L’étape d’identification des adresses permet de ne pas écraser les identifiants Gaïa.<br>
</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="dautres-données" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>D’autres données</h2>
<ul>
<li>Polygones du bâti.<br>
</li>
<li>Polygones Parcelles du cadastre.<br>
</li>
<li>Polygones QPV, zonages infra, iris.</li>
</ul>
<p>Pas d’identifiant Gaïa, donc <span class="blue2"><strong>pas de suivi dans le temps de ces objets</strong></span>.</p>
</section>
<section id="exemples-de-géométries" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Exemples de géométries</h2>
<p><em>Exemple de géométries d’adresses, parcelles et bâtis</em></p>

<img data-src="img/adresses_parcelles_bati.png" class="quarto-figure quarto-figure-center r-stretch" style="width:75.0%"></section>
<section id="quelques-métriques-sur-le-référentiel" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Quelques métriques sur le référentiel</h2>
<ul>
<li>Nombre d’adresses ≃ 27 millions.<br>
</li>
<li>Nombre de voies ≃ 3 millions.</li>
</ul>
<!-- Est ce que les m&#xE9;triques sont correctes ? -->
</section></section>
<section id="plan-de-la-présentation-1" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>Plan de la présentation</h1>
<p>1️⃣ Contexte</p>
<p><strong>2️⃣ Utilisation du référentiel Gaïa</strong></p>
<p>3️⃣ Moteur de recherche ElasticSearch</p>
<p>4️⃣ Algorithme d’identification d’adresses</p>
<p>5️⃣ Performances de l’algorithme d’identification</p>
<p>6️⃣ Discussion</p>
</section>

<section>
<section id="utilisation-du-référentiel-gaïa" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>2️⃣ Utilisation du référentiel Gaïa</h1>

</section>
<section id="différents-besoins-au-sein-du-ssp" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Différents besoins au sein du SSP</h2>
<ul>
<li><span class="red2"><strong>Résil :</strong></span>
<ul>
<li>Identification le(s) adresse(s) des individus.<br>
</li>
<li>Regroupement des adresses avec différents identifiants Gaïa mais qui représentent le même lieu.</li>
</ul></li>
<li><strong>Géoloc :</strong> identification du référentiel Géoloc et génération de leur nouveau référentiel.<br>
</li>
<li>Autres utilisateurs possibles :
<ul>
<li>Identification des adresses sur les certificats de décès.<br>
</li>
<li>Identification des adresses de Sirus.</li>
</ul></li>
</ul>
<!-- ## Regroupements d'adresses

Nouvel objet g&#xE9;ographique :  [**le lieu g&#xE9;ographique**]{.green2}.  

<br>

![](img/adresses_parcelles_bati.png){width=75% fig-align="center"}


## Le lieu g&#xE9;ographique

[**Utilisation :**]{.blue2}  Regrouper les adresses avec diff&#xE9;rents identifiants Ga&#xEF;a mais qui repr&#xE9;sentent le m&#xEA;me lieu.

<br>

*Exemple : plusieurs adresses pour une m&#xEA;me maison si elle a diff&#xE9;rentes entr&#xE9;es &#x2192; m&#xEA;me lieu g&#xE9;ographique.* -->
</section>
<section id="besoin-didentification-des-adresses-textuelles" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Besoin d’identification des adresses textuelles</h2>
<p><span class="green2"><strong>Trouver l’identifiant d’adresse à partir d’un libellé d’adresse plus ou moins correcte.</strong></span></p>
<ul>
<li>Besoin visiblement récurrent au sein du SSP.<br>
</li>
<li>Indispensable pour construire et mettre à jour le référentiel.</li>
</ul>
<p>Il faut donc un <span class="blue2"><strong>moteur de recherche</strong></span> ⚙️.</p>
</section></section>
<section id="plan-de-la-présentation-2" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>Plan de la présentation</h1>
<p>1️⃣ Contexte</p>
<p>2️⃣ Utilisation du référentiel Gaïa</p>
<p><strong>3️⃣ Moteur de recherche ElasticSearch</strong></p>
<p>4️⃣ Algorithme d’identification d’adresses</p>
<p>5️⃣ Performances de l’algorithme d’identification</p>
<p>6️⃣ Discussion</p>
</section>

<section>
<section id="moteur-de-recherche-elasticsearch" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>3️⃣ Moteur de recherche ElasticSearch</h1>

</section>
<section id="adresses-à-retrouver-dans-gaïa" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Adresses à retrouver dans Gaïa</h2>
<h6 data-background-image="background.svg" data-background-size="contain" id="exemple-dadresses-à-retrouver"><em>Exemple d’adresses à retrouver :</em></h6>
<table class="caption-top">
<colgroup>
<col style="width: 34%">
<col style="width: 12%">
<col style="width: 23%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Adresse à retrouver</strong></th>
<th><strong>COG</strong></th>
<th><strong>Code Postal</strong></th>
<th><strong>Libellé commune</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>131, rue du fbg Bannier</td>
<td></td>
<td>45000</td>
<td>Orléans</td>
</tr>
<tr class="even">
<td>0033 ave J. Jaurès</td>
<td>92040</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h6 data-background-image="background.svg" data-background-size="contain" id="adresses-dans-gaïa"><em>Adresses dans Gaïa :</em></h6>
<table class="caption-top">
<thead>
<tr class="header">
<th><strong>Adresse</strong></th>
<th><strong>COG</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>131 rue du faubourg bannier</td>
<td>45234</td>
</tr>
<tr class="even">
<td>33 avenue jean jaures</td>
<td>92040</td>
</tr>
</tbody>
</table>
<aside class="notes">
<p>C’est pourquoi il faut un moteur de recherche ⚙️.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="un-moteur-de-recherche" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Un moteur de recherche ⚙️</h2>
<ul>
<li><strong>Google</strong> : recherche par mot clé.<br>
</li>
<li>Pour la recherche d’adresse :
<ul>
<li><strong>Google Maps</strong>.</li>
<li><strong>Addok</strong> : moteur de recherche de la BAN.</li>
</ul></li>
</ul>
</section>
<section id="elasticsearch" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>ElasticSearch</h2>
<ul>
<li>Créé en <strong>2010</strong> par Shay Bannon.<br>
</li>
<li>Moteur ⚙️ utilisable en <span class="green2"><strong>n’importe quel langage de programmation</strong></span> (requêtes HTTP).<br>
</li>
<li>Faire des recherches rapides sur tout type de données (textes, objets géométriques…).</li>
</ul>
<aside class="notes">
<p>Pour trier et chercher les recettes de cuisine de sa femme psq il trouvait pas de moteur de recherche adapté.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="cest-quoi-concrètement-elasticsearch" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>C’est quoi concrètement ElasticSearch ?</h2>
<ul>
<li><p><span class="blue2"><strong>ElasticSearch</strong></span> : logiciel pour l’indexation et la recherche de données.</p></li>
<li><p>Utilisation en pratique avec <span class="green2"><strong>Python</strong></span> : packages <em>elasticsearch</em> et <em>elasticsearch-dsl</em>.</p></li>
</ul>
</section>
<section id="pourquoi-elasticsearch-pour-la-recherche-textuelle" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Pourquoi ElasticSearch pour la recherche textuelle ?</h2>
<table class="caption-top">
<colgroup>
<col style="width: 50%">
<col style="width: 25%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Critères</strong></th>
<th style="text-align: center;"><strong>ElasticSearch</strong></th>
<th style="text-align: center;"><strong>SQL</strong></th>
<th style="text-align: center;"><strong>Addok</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Recherche de texte avancée</td>
<td style="text-align: center;">✅</td>
<td style="text-align: center;">❌</td>
<td style="text-align: center;">✅</td>
</tr>
<tr class="even">
<td style="text-align: left;">Personnalisation des recherches</td>
<td style="text-align: center;">✅</td>
<td style="text-align: center;">❌</td>
<td style="text-align: center;">❌</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rapidité</td>
<td style="text-align: center;">✅</td>
<td style="text-align: center;">✅</td>
<td style="text-align: center;">✅</td>
</tr>
<tr class="even">
<td style="text-align: left;">Précision</td>
<td style="text-align: center;">✅</td>
<td style="text-align: center;">❌</td>
<td style="text-align: center;">⚠️</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Facilité d’implémentation</td>
<td style="text-align: center;">❌</td>
<td style="text-align: center;">✅</td>
<td style="text-align: center;">✅</td>
</tr>
<tr class="even">
<td style="text-align: left;">Maintenance</td>
<td style="text-align: center;">⚠️</td>
<td style="text-align: center;">✅</td>
<td style="text-align: center;">❌</td>
</tr>
</tbody>
</table>
<aside class="notes">
<p>Donner explication addok</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<!-- a refaire car je ne connais pas addok, j'ai pas compris -->
<!-- | **Crit&#xE8;res**                     | **Elasticsearch (Avantages)**                                                                                             | **SQL (Inconv&#xE9;nients)**                                                                                       |
|----------------------------------|----------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------|
| **Recherche de texte avanc&#xE9;e**   | Con&#xE7;u pour la recherche full-text avec tol&#xE9;rance aux fautes d'orthographe (fuzzy search, correspondance partielle)         | Requ&#xEA;tes full-text limit&#xE9;es et moins adapt&#xE9;es aux variations d'orthographe                                    |
| **Performances**                 | Optimis&#xE9; pour les recherches intensives sur de gros volumes de texte                                                       | Moins performant pour des recherches complexes ou de grandes quantit&#xE9;s de donn&#xE9;es textuelles                  |
| **Personnalisation des scores**  | Permet de pond&#xE9;rer et personnaliser les scores des r&#xE9;sultats pour une meilleure pertinence                                | Les options de personnalisation des scores sont limit&#xE9;es                                                      |
| **Scalabilit&#xE9;**                  | Distribution facile sur plusieurs n&#x153;uds pour g&#xE9;rer de grands ensembles de donn&#xE9;es                                         | Scalabilit&#xE9; plus complexe et generalement moins performante pour des recherches intensives                    |
| **Flexibilit&#xE9; des requ&#xEA;tes**     | Recherches avanc&#xE9;es comme les synonymes, phon&#xE9;tique, et suggestions automatiques                                          | Requ&#xEA;tes avanc&#xE9;es limit&#xE9;es, difficile &#xE0; impl&#xE9;menter en SQL                                                    |
| **Complexit&#xE9; d'impl&#xE9;mentation**  | Peut &#xEA;tre complexe &#xE0; mettre en &#x153;uvre pour des &#xE9;quipes non famili&#xE8;res avec l'outil                                         | Plus simple et souvent mieux ma&#xEE;tris&#xE9; par les &#xE9;quipes                                                        |
| **Consommation des ressources**  | Consomme plus de m&#xE9;moire et de CPU, en particulier pour l'indexation initiale                                             | Consommation de ressources generalement inf&#xE9;rieure pour des requ&#xEA;tes simples                                  |
| **Co&#xFB;t de stockage**             | Peut impliquer une duplication des donn&#xE9;es (co&#xFB;t suppl&#xE9;mentaire de stockage)                                              | Pas de duplication n&#xE9;cessaire                                                                                 | -->
<!-- ## Outils pour moteur ElasticSearch

- [**Mappings**]{.blue2} &#x1F3F7;&#xFE0F; : sp&#xE9;cifier les traitements &#xE0; appliquer pour chaque variable de nos donn&#xE9;es.  
  - *Variable_a &#x2192; Analyzer_for_numbers*  
  - *Variable_b &#x2192; Analyzer_for_address_text*  
  - *Variable_c &#x2192; Analyzer_for_address_text*  
- [**Settings**]{.blue2} &#x1F6E0;&#xFE0F; : d&#xE9;finir les diff&#xE9;rents traitements.  
  - *Analyzer_for_numbers &#x2192; Filtre_&#x3B1;, Filtre_&#x3B2; + Tokenizer_1*  
  - *Analyzer_for_address_text &#x2192; Filtre_&#x3B3;, Filtre_&#x3B4;, Filtre_&#x3B5; + Tokenizer_2*  
- [**Requ&#xEA;tes**]{.blue2} &#x1F50D; : recherche sur les variables d&#xE9;finies dans les mappings.  

::: {.notes}
Et &#xE9;ventuellement, savoir coder en Python/Java...
::: 

On peut commencer &#xE0; cr&#xE9;er notre moteur &#x2699;&#xFE0F;. -->
</section></section>
<section>
<section id="étape-1-pouvoir-comparer-ladresse-recherchée-avec-les-données-gaïa." class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>Étape 1 : pouvoir comparer l’adresse recherchée avec les données Gaïa.</h1>

</section>
<section id="filtres" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Filtres</h2>
<!-- - D&#xE9;finis dans les *settings* &#x1F6E0;&#xFE0F;.   -->
<ul>
<li>Normaliser le texte pour la comparaison.<br>
</li>
<li>Pour les <span class="green2"><strong>données du référentiel</strong></span> ET pour les <span class="blue2"><strong>adresses recherchées</strong></span>.</li>
</ul>
</section>
<section id="filtres-implémentés" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Filtres implémentés</h2>
<ul>
<li>Lowercase<br>
</li>
<li>Asciifolding<br>
</li>
<li>Ponctuation<br>
</li>
<li>Séparation des nombres et lettres <em>(ex : 1er → 1 er)</em><br>
</li>
<li>Suppression des espaces supplémentaires<br>
</li>
<li>Suppression des “0” devant les nombres <em>(ex : 0033 → 33)</em><br>
</li>
<li><span class="red2"><strong>Prise en compte des synonymes</strong></span> <em>(ex : ave = avenue, st = saint)</em></li>
</ul>
</section></section>
<section>
<section id="étape-2-définir-un-score-pour-évaluer-la-pertinence." class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>Étape 2 : définir un score pour évaluer la pertinence.</h1>

</section>
<section id="base-de-données-classique" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Base de données classique</h2>
<p><em>Exemple</em></p>
<table class="caption-top">
<thead>
<tr class="header">
<th>idVoie</th>
<th style="text-align: left;">nom de voie</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td style="text-align: left;">du general leclerc</td>
</tr>
<tr class="even">
<td>B</td>
<td style="text-align: left;">du general charles de gaulle</td>
</tr>
<tr class="odd">
<td>C</td>
<td style="text-align: left;">du point du jour</td>
</tr>
<tr class="even">
<td>D</td>
<td style="text-align: left;">verdier</td>
</tr>
<tr class="odd">
<td>E</td>
<td style="text-align: left;">des cours</td>
</tr>
</tbody>
</table>
</section>
<section id="recherche-par-mot" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Recherche par mot</h2>
<p><span class="blue2"><strong>Pour chaque nom de voie du référentiel</strong></span>, compter le nombre de mots qui matchent 🎯 avec les mots de l’adresse recherchée.</p>
<p><br></p>
<p><em>Exemple : score avec tokenizer “mot” de “88 avenue du general charles de gaulle”</em></p>
<table class="caption-top">
<thead>
<tr class="header">
<th>idVoie</th>
<th style="text-align: left;">nom de voie</th>
<th>score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td style="text-align: left;"><strong>du general</strong> leclerc</td>
<td>2</td>
</tr>
<tr class="even">
<td>B</td>
<td style="text-align: left;"><strong>du general charles de gaulle</strong></td>
<td>5</td>
</tr>
<tr class="odd">
<td>C</td>
<td style="text-align: left;"><strong>du</strong> point <strong>du</strong> jour</td>
<td>2</td>
</tr>
<tr class="even">
<td>D</td>
<td style="text-align: left;">verdier</td>
<td>0</td>
</tr>
<tr class="odd">
<td>E</td>
<td style="text-align: left;">des cours</td>
<td>0</td>
</tr>
</tbody>
</table>
<aside class="notes">
<ul>
<li>Un match c’est chercher si une sous chaine du nom de voie, ici un mot, est incluse dans l’adresse recherchée.<br>
</li>
<li>Recherche par groupes de caractères également possible, abordée dans la suite.<br>
</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="score-avec-tokenizer-mot" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Score avec tokenizer “mot”</h2>
<p><span class="green2"><strong>Tokenizer</strong></span> = façon de découper le texte recherché et ciblé.</p>
<p><br></p>
<p><span class="blue2"><strong>Pour retourner la voie la plus pertinente</strong></span>, on construit un score pour chaque voie : <span class="math display">\[
score_{voie} = \sum_{\text{∀m} \in \text{M}} {nb\_occurrence}_m
\]</span></p>
<p>m = mot.<br>
M = ensemble des mots de l’adresse recherchée.</p>
<p><span class="red2"><strong>Dans une grande base de données, c’est extrêmement long.</strong></span></p>
</section></section>
<section>
<section id="étape-3-utiliser-un-index-inversé.-mais-quest-ce-donc" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>Étape 3 : utiliser un index inversé. Mais qu’est ce donc ?</h1>

</section>
<section id="index-inversé-mot" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Index inversé mot</h2>
<p><em>Exemple</em></p>
<!-- | idVoie | nom de voie             |                        | mot     | occurrences              |
|---|:-----------------------------|                        |-----------|--------------------------|
| A | du general leclerc           |                        | general   | {"A": 1, "B": 1}         |
| B | du general charles de gaulle |        devient         | jour      | {"C": 1}                 |
| C | du point du jour             |                        | du        | {"A": 1, "B": 1, "C": 2} |
| D | verdier                      |                        | ...       | ...                      |
| E | des cours                    | -->
<div style="display: flex; justify-content: space-between;">
<table>
<thead>
<tr>
<th>
idVoie
</th>
<th>
nom de voie
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
A
</td>
<td>
du general leclerc
</td>
</tr>
<tr>
<td>
B
</td>
<td>
du general charles de gaulle
</td>
</tr>
<tr>
<td>
C
</td>
<td>
du point du jour
</td>
</tr>
<tr>
<td>
D
</td>
<td>
verdier
</td>
</tr>
<tr>
<td>
E
</td>
<td>
des cours
</td>
</tr>
</tbody>
</table>
<!-- Ajoutez un espacement entre les deux tableaux -->
<div style="margin-left: 130px;">

</div>
<table>
<thead>
<tr>
<th>
mot
</th>
<th>
occurrences
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
general
</td>
<td>
{“A”: 1, “B”: 1}
</td>
</tr>
<tr>
<td>
jour
</td>
<td>
{“C”: 1}
</td>
</tr>
<tr>
<td>
du
</td>
<td>
{“A”: 1, “B”: 1, “C”: 2}
</td>
</tr>
<tr>
<td>
cours
</td>
<td>
{“E”: 1}
</td>
</tr>
<tr>
<td>
…
</td>
<td>
…
</td>
</tr>
</tbody>
</table>
</div>
<p><span class="green2"><strong>Comptage direct ⚡ des occurrences</strong></span> de chaque mot de la base par idVoie.</p>
<aside class="notes">
<ul>
<li>Faire un index inversé par mot, c’est récupérer tous les mots des noms de voie dans le référentiel et on les aplati dans une colonne.<br>
</li>
<li>Il y a autant de lignes qu’il y a de mots différents dans les noms de voie du référentiel. Les mots les plus fréquents seront ceux qui ont le plus d’occurences.<br>
</li>
<li>Nous obtenons directement le comptage de chaque mot par idVoie, pour tous les mots présents dans les noms de voie du référentiel.<br>
</li>
<li>L’index inversé est fait en amont des requetes.<br>
</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="étape-4-prendre-en-compte-les-variations-textuelles." class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>Étape 4 : prendre en compte les variations textuelles.</h1>

</section>
<section id="fuzziness" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Fuzziness</h2>
<p><span class="blue2"><strong>Contourner les petites fautes d’orthographes</strong></span> : <span class="green2"><strong>fuzziness</strong></span>.</p>
<p>Pour matcher 🎯 deux mots avec une fuzziness de niveau 1 = corriger l’un des mots :</p>
<ul>
<li>Ajout d’une lettre. <em>Ex: “verdiier”</em><br>
</li>
<li>Suppression d’une lettre. <em>Ex: “verdie”</em><br>
</li>
<li>Remplacement d’une lettre. <em>Ex: “verfier”</em><br>
</li>
<li>Échanger deux lettres de place. <em>Ex: “evrdier”</em></li>
</ul>
<p>Il est possible de comparer deux textes, deux n-grams ou n’importe quel autre groupe de caractères.</p>
</section>
<section id="recherche-par-n-grams-de-caractères" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Recherche par n-grams de caractères</h2>
<p><span class="blue2"><strong>Prendre en compte les correspondances partielles</strong></span> : chaque mot est découpé en sous-chaînes de n caractères consécutifs.</p>
<p><br></p>
<p><em>Exemple de découpage en 3-grams de caractères du texte “avenue verdier” :</em><br>
<strong>ave, ven, enu, nue, ver, erd, rdi, die, ier</strong></p>
<p><br></p>
<p>Si un mot est inférieur à la taille n, il n’aura pas de découpage en n-grams → pas présent dans l’index inversé n-gram.</p>
</section>
<section id="index-inversé-3-grams" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Index inversé 3-grams</h2>
<p><em>Exemple</em></p>
<!-- | 3-grams | occurrences           |
|---------|-----------------------|
| gen     | {"A": 1, "B": 1}      |
| cha     | {"B": 1}              |
| our     | {"C": 1, "E": 1}      |
| ...     | ...                   | -->
<div style="display: flex; justify-content: space-between;">
<table>
<thead>
<tr>
<th>
idVoie
</th>
<th>
nom de voie
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
A
</td>
<td>
du general leclerc
</td>
</tr>
<tr>
<td>
B
</td>
<td>
du general charles de gaulle
</td>
</tr>
<tr>
<td>
C
</td>
<td>
du point du jour
</td>
</tr>
<tr>
<td>
D
</td>
<td>
verdier
</td>
</tr>
<tr>
<td>
E
</td>
<td>
des cours
</td>
</tr>
</tbody>
</table>
<!-- Ajoutez un espacement entre les deux tableaux -->
<div style="margin-left: 40px;">

</div>
<table>
<thead>
<tr>
<th>
3-gram
</th>
<th>
occurrences
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
gen
</td>
<td>
{“A”: 1, “B”: 1}
</td>
</tr>
<tr>
<td>
cha
</td>
<td>
{“B”: 1}
</td>
</tr>
<tr>
<td>
our
</td>
<td>
{“C”: 1, “E”: 1}
</td>
</tr>
<tr>
<td>
oin
</td>
<td>
{“C”: 1}
</td>
</tr>
<tr>
<td>
…
</td>
<td>
…
</td>
</tr>
</tbody>
</table>
</div>
<aside class="notes">
<ul>
<li>Il y a autant de lignes qu’il ya de trigrams différents dans les noms de voie du référentiel.<br>
</li>
<li>Si un mot est inférieur à la taille n=3, il ne sera pas pris en compte. Par exemple : du général de gaules, “du” et “de” n’apparaîtront pas dans l’index et donc ne seront pas pris en compte dans les matchs trigrams.<br>
</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="score-avec-tokenizer-n-grams" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Score avec tokenizer “n-grams”</h2>
<p>Score pour chaque voie : <span class="math display">\[
score_{voie} = \sum_{\text{∀ngram} \in \text{N}} {nb\_occurrence}_{ngram}
\]</span></p>
<p>N = ensemble des n-grams de l’adresse recherchée.</p>
</section>
<section id="limites-des-n-grams" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Limites des n-grams</h2>
<p><span class="math display">\[
\downarrow \text{taille n-grams}
\Rightarrow \text{taille index inversé} \uparrow
\Rightarrow \text{temps de recherche} \uparrow
\]</span></p>
<ul>
<li>Limitation à n∈{3,4,5} pour notre cas.<br>
</li>
<li>Tests effectués pour choisir ces valeurs, en fonction de <span class="blue2"><strong>la précision et la rapidité</strong></span> des requêtes.</li>
</ul>
</section>
<section id="boost" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Boost</h2>
<ul>
<li>On peut donner plus ou moins d’importance aux différents matchs 🎯.<br>
</li>
<li>Chaque occurrence est multipliée par un facteur, appelé <span class="blue2"><strong>boost</strong></span>, qui dépend du niveau de match 🎯.</li>
</ul>
</section>
<section id="score-global" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Score global</h2>
<p>Le score global va donc combiner la somme des matchs 🎯 au niveau :</p>
<ul>
<li>mot.<br>
</li>
<li>n-grams.<br>
</li>
<li>fuzziness.</li>
</ul>
<p>Et <span class="green2"><strong>booster</strong></span> en fonction de l’importance qu’on leur donne.</p>
<!-- ## Configurer le moteur &#x2699;&#xFE0F;

Une fois qu'on a la th&#xE9;orie, il faut l'appliquer en pratique.  

Le package elasticsearch permet d'indexer les donn&#xE9;es en fournissant :  

- Un dataframe &#x1F4CB; des donn&#xE9;es du r&#xE9;f&#xE9;rentiel Ga&#xEF;a.  
- Des [**settings**]{.blue2} &#x1F6E0;&#xFE0F; o&#xF9; on d&#xE9;finit nos diff&#xE9;rents **analyzers**, englobant les filtres et le motizer.  
- Des [**mappings**]{.green2} &#x1F3F7;&#xFE0F; o&#xF9; pour chaque **variable**, on fournit un analyzer.   -->
</section>
<section id="faire-des-recherches" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Faire des recherches 🔍</h2>
<p><em>Requête 🔍 pour retrouver la voie :</em></p>
<ul>
<li>Match 🎯 nom de voie entier sans découpage avec fuzzi 1, <strong>boost 200</strong>. <em>Ex : “3 rue du genral de gaulle” ⊃ “du gen<span class="red2"><strong>e</strong></span>ral de gaulle”</em>.<br>
</li>
<li>Match 🎯 chaque mot du nom de voie avec fuzzi 1, <strong>boost 15</strong>.<br>
</li>
<li>Match 🎯 chaque mot du type de voie avec fuzzi 1, <strong>boost 5</strong>.<br>
</li>
<li>Match 🎯 chaque 3 à 5-grams du nom de voie, <strong>boost 1</strong>.</li>
</ul>
<p>À chaque fois qu’une sous-chaîne valide l’une de ces conditions, le score va ⇡ en fonction du boost associé.</p>
<aside class="notes">
<ul>
<li>On match à chaque 3-grams, exemple avec verdier.<br>
</li>
<li>Les ngrams c’est notre dernier recours, on va retourner comme voie plus pertinente les match sur nom de voie complet et sur token mais ngrams c’est notre roue de secours.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="retour-sur-le-score-global" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Retour sur le score global</h2>
<p><span class="math display">\[
score_{voie} = \sum_{\text{∀n} \in \text{N}} \sum_{\text{∀t} \in \text{n}} boost_{n}*{nb\_occurrence}_{t}
\]</span></p>
<p>N = ensemble des niveaux <em>(niveau mot, niveau fuzzi…)</em>.<br>
n = niveau.<br>
t = token, sous-chaîne <em>(un mot, un 3-grams…)</em>.</p>
</section></section>
<section id="plan-de-la-présentation-3" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>Plan de la présentation</h1>
<p>1️⃣ Contexte</p>
<p>2️⃣ Utilisation du référentiel Gaïa</p>
<p>3️⃣ Moteur de recherche ElasticSearch</p>
<p><strong>4️⃣ Algorithme d’identification d’adresses</strong></p>
<p>5️⃣ Performances de l’algorithme d’identification</p>
<p>6️⃣ Discussion</p>
</section>

<section>
<section id="algorithme-didentification-dadresses" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>4️⃣ Algorithme d’identification d’adresses</h1>

</section>
<section id="algorithme-didentification-dadresses-1" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Algorithme d’identification d’adresses</h2>
<ul>
<li>Prends en entrée un <span class="green2"><strong>libellé d’adresse</strong></span> et un <span class="blue2"><strong>COG</strong></span>, ou à défaut, <span class="blue2"><strong>un code postal + libellé commune</strong></span>.<br>
</li>
<li>Retourne :
<ul>
<li>le(s) identifiant(s) Gaïa retrouvé(s).<br>
</li>
<li>une indicatrice sur la qualité de l’identification (0 à 10).<br>
</li>
<li>un ratio qui mesure l’écart entre la 1ère et la 2ème voie la plus pertinente retournées par Elastic (0 à 1).</li>
</ul></li>
</ul>
</section>
<section id="schéma-algorithme-didentification" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Schéma algorithme d’identification</h2>

<img data-src="img/schema_moteur_fr.png" class="quarto-figure quarto-figure-center r-stretch" style="width:75.0%"><aside class="notes">
<ul>
<li>Entre chaque requête Elastic, il y a des étapes de validation du résultat ES.<br>
</li>
<li>Identification stricte : une recherche l’adresse comme un appariement direct avec notre référentiel Gaïa, mais on applique les filtres en amont.<br>
</li>
<li>En moyenne, sur une base de données d’adresses non normalisées, il y a 30% des adresses qui passent à la première étape de l’identification. Cette identification stricte permet donc d’accélerer le processus, car elle prend 6 fois moins de temps que les requêtes floues sur le nom de voie.<br>
</li>
<li>Comme les bases de données qui alimentent notre référentiel sont plutôt normalisées, cela accélère d’autant plus notre processus d’identification.<br>
</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="indicatrice-qualité" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Indicatrice qualité</h2>
<ul>
<li>Dépend du pourcentage de 3-grams de la <span class="blue2"><strong>voie du référentiel</strong></span> ⊂ <span class="green2"><strong>l’adresse recherchée</strong></span>.</li>
<li>Calcul non réalisable avec Elastic, donc effectué post requête.</li>
</ul>
<table class="caption-top">
<thead>
<tr class="header">
<th>Voie qualifiée de</th>
<th>Pourcentage de 3-grams</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>sûre</td>
<td>≥ 65%</td>
</tr>
<tr class="even">
<td>peu douteuse</td>
<td>35% ≤ x &lt; 65%</td>
</tr>
<tr class="odd">
<td>douteuse</td>
<td>10% ≤ x &lt; 35%</td>
</tr>
<tr class="even">
<td>non retrouvée</td>
<td>&lt; 10%</td>
</tr>
</tbody>
</table>
<p><em>Exemple : 80% des 3-grams de “verdier” dans “88 avenue verdie”.</em></p>
<aside class="notes">
<ul>
<li><p>Le trigram “ier” n’est jamais matché<br>
</p></li>
<li><p>verdier : 5 trigrams<br>
</p></li>
<li><p>4 trigrams retrouvés dans 88 avenue verdier<br>
</p></li>
<li><p>4*100/5 = 80</p></li>
<li><p>Ces valeurs n’ont pas été choisies aux hasard, elles ont été calculées grâce au jeu de test que nous allons vous présenter ensuite. Et nous avons regardé la courbe Précision-Rappel.</p></li>
<li><p>Précision = Vrais positifs/ positifs (vp + fp)</p></li>
<li><p>Rappel = Vrais positifs / Bons prédits (vp + vn)</p></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="valeurs-de-lindicatrice-qualité" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Valeurs de l’indicatrice qualité</h2>
<table class="caption-top">
<thead>
<tr class="header">
<th>Valeur</th>
<th>idGaïa maximum retrouvé</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>6 à 10</td>
<td>idAdresse</td>
</tr>
<tr class="even">
<td>3 à 5</td>
<td>idVoie</td>
</tr>
<tr class="odd">
<td>2</td>
<td>idCommune</td>
</tr>
<tr class="even">
<td>0 à 1</td>
<td>Aucun</td>
</tr>
</tbody>
</table>
</section>
<section id="distance-entre-la-1ère-et-la-2ème-voie-la-plus-pertinente" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Distance entre la 1ère et la 2ème voie la plus pertinente</h2>
<p><span class="math display">\[
\text{ratio} = 1 - \frac{R_2}{R_1}
\]</span></p>
<p>R1 = score Elastic de la 1ère voie la plus pertinente (voie retournée).<br>
R2 = score Elastic de la 2ème voie la plus pertinente.</p>
<p>Ratio → 1 ⇔ le résultat retourné est loin de la 2ème proposition.</p>
</section></section>
<section id="plan-de-la-présentation-4" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>Plan de la présentation</h1>
<p>1️⃣ Contexte</p>
<p>2️⃣ Utilisation du référentiel Gaïa</p>
<p>3️⃣ Moteur de recherche ElasticSearch</p>
<p>4️⃣ Algorithme d’identification d’adresses</p>
<p><strong>5️⃣ Performances de l’algorithme d’identification</strong></p>
<p>6️⃣ Discussion</p>
</section>

<section>
<section id="performances-de-lalgorithme-didentification" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>5️⃣ Performances de l’algorithme d’identification</h1>

</section>
<section id="constitution-dun-jeu-de-test" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Constitution d’un jeu de test</h2>
<ul>
<li><span class="red2"><strong>Idée : avoir des adresses avec des variations textuelles et leur idGaïaAdresse associé (vérité).</strong></span><br>
</li>
<li>Le jeu de test est une suite d’appariements de sources de données :
<ul>
<li><strong>PASRAU</strong> : Prélèvement À la Source sur les Revenus AUtres.<br>
</li>
<li><strong>TSSAL</strong> : Base tous salariés, issue de la déclaration sociale nominative.<br>
</li>
<li><strong>Fidéli</strong> : FIchiers DÉmographiques sur les Logements et les Individus.<br>
</li>
</ul></li>
<li>Validation post-appariements des paires adresse non normalisée + idGaïaAdresse.</li>
</ul>
</section>
<section id="schéma-appariements-jeu-de-test" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Schéma appariements jeu de test</h2>

<img data-src="img/jeu_test.png" class="quarto-figure quarto-figure-center r-stretch" style="width:75.0%"><aside class="notes">
<ul>
<li>PASRAU : Ce sont des données administratives générées par le prélèvement à la source sur les retraites et d’autres revenus (mais pas les salaires).</li>
<li>Adresses du PASRAU et Tous Salariés (TTSAL) avec le CSNS de l’individu connu pour chaque adresse.<br>
</li>
<li>Grâce aux CSNS des individus Fidéli 2022, obtention de l’identifiant Majic de ces adresses.</li>
<li>Avec l’identifiant Majic des adresses, conservé dans le référentiel Gaïa, on retrouve l’idGaïaAdresse.<br>
</li>
<li>Les adresses (PASRAU, TSSAL) sont comparées aux adresses du référentiel, et seules les paires considérées comme identiques sont conservées.<br>
</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="évaluation-de-lalgorithme-didentification" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Évaluation de l’algorithme d’identification</h2>
<p>Pour 100 000 adresses issues du jeu de test sur tout le territoire français :</p>
<table class="caption-top">
<colgroup>
<col style="width: 17%">
<col style="width: 23%">
<col style="width: 19%">
<col style="width: 39%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Adresse trouvée</strong></th>
<th><strong>Voie trouvée</strong></th>
<th><strong>Commune trouvée/rien trouvé</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Pourcentage</strong></td>
<td><span class="red2"><strong>86,0%</strong></span></td>
<td><span class="red2"><strong>99,5%</strong></span></td>
<td>0,5%</td>
</tr>
<tr class="even">
<td><strong>Précision</strong></td>
<td>0.94</td>
<td>0.94</td>
<td>x</td>
</tr>
</tbody>
</table>
<p>Appariement direct avec filtres entre adresses à retrouver et référentiel Gaïa : <span class="blue2"><strong>30% d’identification à l’adresse</strong></span>.</p>
<aside class="notes">
<ul>
<li><p>Précision = Vrais positifs/ positifs (vp + fp)</p></li>
<li><p>A titre de comparaison, un appariement direct entre les adresses à retrouver et le référentiel Gaïa donnerait 30% d’identification à condition que les filtres présentés précédemment soient appliqués.<br>
</p></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="rapidité-de-lalgorithme" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Rapidité de l’algorithme</h2>
<ul>
<li><span class="blue2"><strong>500 adresses en 2 secondes</strong></span>.<br>
</li>
<li>Identification de gros paquets d’adresses : <span class="green2"><strong>1 million d’adresses en 50 minutes</strong></span>. <!-- - D&#xE9;monstration en utilisant [l'API Ga&#xEF;a](https://api-interrogation-geo.insee.fr/swagger-ui/index.html).   --></li>
</ul>
<!-- ## Utilisation du moteur au sein du projet Ga&#xEF;a

M&#xE9;triques sur les mises &#xE0; jour du r&#xE9;f&#xE9;rentiel :
- .... -->
</section></section>
<section id="plan-de-la-présentation-5" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>Plan de la présentation</h1>
<p>1️⃣ Contexte</p>
<p>2️⃣ Utilisation du référentiel Gaïa</p>
<p>3️⃣ Moteur de recherche ElasticSearch</p>
<p>4️⃣ Algorithme d’identification d’adresses</p>
<p>5️⃣ Performances de l’algorithme d’identification</p>
<p><strong>6️⃣ Discussion</strong></p>
</section>

<section>
<section id="discussion" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>6️⃣ Discussion</h1>

</section>
<section id="limites" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Limites</h2>
<ul>
<li>Compétences requises pour le développement et la maintenance du moteur ElasticSearch.<br>
</li>
<li>Moteur créé par l’EPS en Python, réécrit en Java par l’EPI.<br>
</li>
<li>Les travaux ont été effectués sur un référentiel contenant des erreurs/doublons → entrave les métriques qualité.</li>
</ul>
</section></section>
<section id="bibliographie" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>Bibliographie</h1>
<ol type="1">
<li><p>Chaudhuri, S., et al.&nbsp;(2003). <em>Robust and efficient fuzzy match for online data cleaning</em>. <a href="https://courses.cs.washington.edu/courses/cse591d/03sp/chaudhuri.pdf">lien</a>.</p></li>
<li><p>Kathare, N., et al.&nbsp;(2022). <em>A Comprehensive Study of Elastic Search</em>. <em>Journal of Research in Science and Engineering</em>, 4(11). <a href="https://doi.org/10.53469/jrse.2022.04(11).07">lien</a>.</p></li>
<li><p>Wikipedia. (n.d.). <em>Elasticsearch</em>. <a href="https://fr.wikipedia.org/wiki/Elasticsearch">lien</a>.</p></li>
</ol>
</section>

<section id="merci-au-ssplab-julien-pramil-lino-galiana-olivier-meslin-marie-pierre-joubert-et-tom-seimandi" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>Merci au SSPlab : Julien Pramil, Lino Galiana, Olivier Meslin, Marie-Pierre Joubert et Tom Seimandi</h1>

</section>

<section id="merci-à-heidi-koumarianos" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>Merci à Heidi Koumarianos</h1>

</section>

<section id="et-enfin-merci-pour-votre-attention" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>Et enfin, merci pour votre attention !</h1>


</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': false,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true,"theme":"whiteboard"},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copi&#xE9;");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copi&#xE9;");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/inseefrlab\.github\.io\/address-search-gaia-docs");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>